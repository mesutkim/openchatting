<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
"-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="chatMapper">
	<resultMap type="chat" id="chatResultSet">
		<result column="CHAT_NO" property="chatNo"/>
		<result column="USER_ID" property="userId"/>
		<result column="TITLE" property="title"/>
		<result column="CONTENT" property="content"/>
	</resultMap>
	
	<!-- 채팅 만들기 -->
	<insert id="insertChat" parameterType="chat">
		INSERT
		  INTO
		  		CHAT
		  		(
		  		CHAT_NO
		  		,USER_ID
		  		,TITLE
		  		,CONTENT
		  		)
		VALUES
				(
				SEQ_CNO.NEXTVAL
				,#{userId}
				,#{title}
				,#{content}
				)
	</insert>
	
	<!-- 게시글 총 갯수 조회 -->
	<select id="selectListCount" resultType="_int">
		SELECT
				COUNT(*)
		  FROM
		  		CHAT
		 WHERE
		 		STATUS = 'N'
	</select>
	
	<!-- 전체 게시글 조회 -->
  	<select id="selectChatList" resultMap="chatResultSet">
  		SELECT
  		  		CHAT_NO
  		  		,USER_ID
  		  		,TITLE
  		  		,CONTENT
  		  FROM
  		  		CHAT
  		 WHERE
  		 		STATUS = 'N'
  		 ORDER
  		    BY
  		    	CHAT_NO DESC
  	</select>
  	
  	<!-- 첫번째 채팅 insert -->
  	<insert id="insertFirstChat" parameterType="chat">
  		INSERT
		  INTO
		  		CHAT_DETAIL
		  		(
		  		DETAIL_NO
		  		,CHAT_NO
		  		,USER_ID
		  		,CONTENT
		  		)
		 VALUES
		 		(
		 		SEQ_DCNO.NEXTVAL
		 		,#{chatNo}
		 		,#{userId}
		 		,#{content}
		 		)
  	</insert>
  	
  	<!-- 채팅 여부 검사 -->
  	<select id="selectChatDetailStatus" resultType="_int" parameterType="chat">
  		SELECT
  				COUNT(*)
  		  FROM
  		  		CHAT_DETAIL
  		 WHERE
  		 		CHAT_NO = #{chatNo}
  		   AND
  		   		USER_ID = #{userId}
  	</select>
  	
</mapper>
